<h1>Pedidos</h1>
<p>
  <% form_tag "", :method => :get do %>
  ID <%= text_field_tag "id", params[:id], :size => 4 %>
  Nome/Email comprador <%= text_field_tag "nome_email", params[:nome_email], :size => 20 %>
  CEP <%= text_field_tag "entrega_cep", params[:entrega_cep], :size => 8 %>
  <%= submit_tag "Buscar" %>
  <% end %>
</p>
<table id="lista_de_pedidos" class="crud">
  <thead>
    <tr>
      <th>ID</th>
      <th>Comprador</th>
      <th>Status</th>
      <th>Produtos</th>
      <th>Entrega</th>
      <th>Valor</th>
      <th colspan="1">
        Ações
      </th>
    </tr>
  </thead>
<% for pedido in @pedidos -%>
  <tr id="pedido_<%= pedido.id %>">
    <td class="estreita"><%= pedido.id %></td>
    <td>
      <%= descreve_comprador(pedido) %>
    </td>
    <td class="estreita <%= pedido.status %>">
      <%= descreve_status(pedido) %>
      <%= render :partial => "alterar_status", :locals => { :pedido => pedido } %>
      <%= link_to_function "Alterar...", "displayAlterarStatus(#{pedido.id})", :class => "pequeno" %>
    </td>
    <td>
      <%= descreve_produtos_pedido(pedido) %>
    </td>
    <td>
      <%= descreve_entrega(pedido) %>
    </td>
    <td class="grandao green"><%= number2currency(pedido.total) %></td>
    <td class="acoes">
      <%= link_to_remote image_tag("icones/zoom.png") + " Detalhes", 
                         :url => { :action => "detalhes", 
                                   :id => pedido }, 
                         :update => "pedido_mais_#{pedido.id}",
                         :before => "$('pedido_#{pedido.id}').addClassName('carregando')",
                         :after => "$('pedido_#{pedido.id}').removeClassName('carregando');" + visual_effect(:highlight, "pedido_#{pedido.id}", :duration => 1.5) %><br />
      <%= link_to image_tag("icones/cancel.png") + " Remover", admin_pedido_path(pedido), :confirm => "Tem certeza?", :method => :delete %>
    </td>
  </tr>
  <tr>
    <td colspan="7" id="pedido_mais_<%= pedido.id %>" style="border-top:0">
    </td>
  </tr>
<% end -%>
</table>

<%= will_paginate(@pedidos) %>

<script type="text/javascript" charset="utf-8">
function displayAlterarStatus(pedidoId) {
  var elem = 'alterar_status_'+pedidoId;
  $(elem).show();
}
</script>
<style type="text/css" media="screen">
div.d_status {
  position:absolute;
  border:1px solid gray;
  background:#fff;
  padding:1px 0;
  font-size:11px;
}
table.p_status {
  background:#eee;
  margin:0 1px;
}
table.p_status tr td {
  padding:2px 7px;
  text-align:center;
}
table.p_status tr td.atual { font-style:italic;}
table.p_status tr td.aguardando { background:#FFE69F;}
table.p_status tr td.processando { background:#cc3333;}
table.p_status tr td.enviado { background:#33cc33;}
table.p_status tr td.recebido { background:#929122;}
table.p_status tr td.finalizado { background:#498849;}
table.p_status tr td.cancelado { background:#444;}
table.p_status tr td a {
  color:black;
  text-decoration:none;
  padding:2px;
}
table.p_status tr td a:hover {
  background:black;
  color:#fff;
}
</style>
